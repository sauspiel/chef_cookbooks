# generated by chef for <%= node[:fqdn] %>

<% @zones.each do |zone| %>
zone:
  name: <%= zone['id'].gsub(/_/,".") %>
  zonefile: <%= "#{node[:nsd3][:zonesdir]}/#{zone['id']}" %>
  <% if node[:nsd3][:type] == "master" %>
    <% zone['ns'].select { |ns| ns.fetch("notify_on_update", false) }.map { |slaves| slaves.values[0] }.each do |slave| %>
  notify: <%= slave %> NOKEY
    <% end -%>
    <% zone['ns'].select { |ns| ns.fetch("provide_xfr", false) }.map { |slaves| slaves.values[0] }.each do |slave| %>
  provide-xfr: <%= slave %> NOKEY
    <% end -%>
  <% elsif node[:nsd3][:type] == "slave" %>
  allow-notify: <%= zone['ns'][0].values[0] %> NOKEY
  request-xfr: AXFR <%= zone['ns'][0].values[0] %> NOKEY
  <% end -%>
<% end -%>

